(this["webpackJsonpapp-admin-v5"]=this["webpackJsonpapp-admin-v5"]||[]).push([[70],{1353:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return U}));var a,o=n(13),c=n(4),r=n(22),i=n(1),s=n(0),l=n.n(s),d=n(767),f=n(571),p=n.n(f),u=n(87),b=n(9),j=n(563),h=n(58),m=n(622),v=n(20),O=n(11),g=n(2);function x(e){var t=l.a.useState(""),n=Object(o.a)(t,2),a=n[0],r=n[1],s=l.a.useState(!1),d=Object(o.a)(s,2),f=d[0],p=d[1],j=e.fnList,m=(e.configItem||{}).requestData;return console.warn("render form upload:",e),Object(g.jsxs)("div",{style:{position:"relative"},children:[Object(g.jsx)(i.MyBase,{type:"text",className:"form-control",value:a,onChange:function(e){r(e)},attrs:{placeholder:"Link folder google drive"}}),Object(g.jsx)(u.a,{color:"primary",style:{marginTop:"10px"},onClick:function(){console.warn("submit",a,j),p(!0),Object(h.a)({method:"POST",url:"".concat(b.j.fnGetApiPath(j),"/InsertImagesFromGGDrive"),data:Object(c.a)(Object(c.a)({},m),{},{GGDriveFolderURL:a})}).then((function(e){console.warn("r:",e),e.Data&&b.f.onAfterAddFolderGGDrive(j,[e.Data]),p(!1),b.m.hidePopover(j)})).catch((function(e){console.warn("err:",e),p(!1)}))},children:"Upload"}),!0===f&&Object(g.jsx)("div",{className:"a-overlay a-flex-center",children:Object(g.jsx)(i.MyLoading,{})})]})}function D(e){return Object(g.jsx)(O.i,{overlay:function(t){return Object(g.jsx)(x,Object(c.a)(Object(c.a)({},e),{},{fnList:Object(c.a)(Object(c.a)({},e.fnList),t)}))},overlayClassName:"m-popover",placement:"bottomLeft",destroyTooltipOnHide:!0,children:Object(g.jsx)(u.a,{color:"primary",onClick:function(){},style:{marginLeft:"5px"},children:"Upload from GGDrive"})})}var y=v.b.div(a||(a=Object(r.a)(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  & .a-overlaydrop {\n    position: absolute;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background: #e9e9e9;\n    color: #323232;\n    border: 2px dashed grey;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    opacity: 0.9;\n  }\n  & > div.a-body {\n    & .a-nophotos {\n      min-height: 200px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n  }\n  & > div.a-header {\n    display: flex;\n    border-bottom: 1px solid #e9ecef;\n    margin-bottom: 5px;\n    padding-bottom: 5px;\n  }\n"]))),P=function(e){var t=e.requestData,n=e.cbSuccess,a=e.cbError;Object(h.a)({method:"POST",url:"ProjectPhoto/GetPhotos",data:t}).then((function(e){console.warn("r:",e),n&&n(e)})).catch((function(e){console.warn("err:",e),a&&a(e)}))},w=function(e){var t=e.files,n=e.requestData,a=e.cbSuccess,o=e.cbError;Object(m.a)({method:"UPLOAD",url:"ProjectPhoto/Upload",files:t,timeout:0,customHeader:Object(c.a)({},n)}).then((function(e){console.warn("r:",e),a&&a(e)})).catch((function(e){console.warn("err:",e),o&&o(e)}))};function U(e){var t=e.configFile||{},n=l.a.useState([]),a=Object(o.a)(n,2),r=a[0],s=a[1],f=l.a.useState(!1),h=Object(o.a)(f,2),m=h[0],v=h[1],O=l.a.useState(Object(c.a)({},t)),x=Object(o.a)(O,2),U=x[0],C=x[1],A=U.numCol,E=U.showUploadFromGGDrive,G=U.pasteAsFile,F=e.canUpload,L=e.requestData,k=e.fnList,N=function(){P({requestData:Object(c.a)({},L),cbSuccess:function(e){e&&e.Data&&(e.Data.Configs&&C(Object(c.a)(Object(c.a)({},U),e.Data.Configs)),e.Data.Photos&&s(e.Data.Photos))}})},S=l.a.useCallback((function(e){console.warn("onDrop:",e),F&&(v(!0),w({files:e,requestData:L,cbSuccess:function(e){console.warn("Update OK",e),v(!1),N(),k&&k.onChangeData&&k.onChangeData(e.Data)},cbError:function(){v(!1)}}))}),[]),I=Object(d.b)({onDrop:S}),T=I.getRootProps,q=I.getInputProps,H=I.isDragActive,M=I.open;return l.a.useEffect((function(){return console.warn("firstload",e),N(),1==G&&(j.a.addEventUploadFileAfterPaste((function(e){S(e)})),j.a.addEventPaste()),function(){console.warn("unmount file manager"),j.a.removeEventUploadFileAfterPaste(),j.a.removeEvenPaste()}}),[]),Object(g.jsxs)(y,Object(c.a)(Object(c.a)({className:"mpat-file_manager"},T()),{},{onClick:function(e){e.stopPropagation()},children:[Object(g.jsx)("input",Object(c.a)(Object(c.a)({},q()),{},{style:{display:"none"}})),Object(g.jsxs)("div",{className:"a-header",children:[F&&Object(g.jsxs)("div",{children:[Object(g.jsx)(u.a,{color:"primary",onClick:function(){console.warn("click",M),M()},children:"Upload"}),!0===E&&Object(g.jsx)(D,Object(c.a)(Object(c.a)({},e),{},{configItem:{canDelete:F&&true,requestData:L},fnList:Object(c.a)(Object(c.a)({},k),{},{onAfterAddFolderGGDrive:function(e){var t="";console.warn("onAfterAddFolderGGDrive",e,L),L.FieldName&&e[t=L.FieldName]&&(k&&k.onChangeData&&k.onChangeData(e[t]),e[t].hasOwnProperty("Photos")&&s(e[t].Photos||[]))}})}))]}),Object(g.jsx)("div",{style:{marginLeft:"auto"},children:Object(g.jsx)(u.a,{onClick:function(){b.g.hideModal(k)},children:"Close"})})]}),Object(g.jsx)("div",{className:"a-body",style:{maxHeight:"calc(100vh - 9rem)",overflow:"hidden"},children:Object(g.jsx)(p.a,{children:Object(g.jsx)("div",{style:{maxHeight:"calc(100vh - 9rem)"},children:r&&r.length>0?Object(g.jsx)(i.MyUI,{type:"grid",typeItem:"file_manager_item",configItem:{canDelete:F&&true,requestData:L},fnList:Object(c.a)(Object(c.a)({},k),{},{onAfterDeleteItem:function(e,t){t.hasOwnProperty("Photos")&&s(t.Photos||[]),k&&k.onChangeData&&k.onChangeData(t)}}),data:r,numCol:A}):Object(g.jsx)("div",{className:"a-nophotos",children:"No Photos"})})})}),F&&(!0===H||!0===m)&&Object(g.jsxs)("div",{className:"a-overlaydrop",children:[!1===m&&Object(g.jsx)("div",{children:" Drop the files here ..."}),!0===m&&Object(g.jsx)("div",{children:" Uploading..."})]}),Object(g.jsx)("div",{className:"a-footer"})]}))}},563:function(e,t,n){"use strict";var a={fnUpload:null,fnPatse:function(e){e.preventDefault(),console.warn("paste:",e);var t=e.clipboardData.items;console.warn("paste items:",t);var n=[];if(t){for(var o=0;o<t.length;o++){var c=t[o];if(console.log("Paste Item type: "+c.type,c.kind),"file"==c.kind){var r=c.getAsFile();n.push(r),console.log("Paste Item file: "+c,r)}else{var i=(e.originalEvent||e).clipboardData.getData("text/plain");window.document.execCommand&&window.document.execCommand("insertText",!1,i),console.log("paste text:",i)}}console.log("PasteHelper.fnUpload:",a.fnUpload),a.fnUpload&&n.length>0&&a.fnUpload(n)}},checkPasteSupported:function(){var e=document.createElement("div");return e.setAttribute("onpaste","return;"),"function"==typeof e.onpaste},addEventUploadFileAfterPaste:function(e){a.fnUpload=e},removeEventUploadFileAfterPaste:function(){a.fnUpload=null},removeEvenPaste:function(){window.removeEventListener("paste",a.fnPatse,!1)},addEventPaste:function(){window.addEventListener("paste",a.fnPatse,!1)},copyTextToClipboard:function(e,t){navigator&&navigator.clipboard&&navigator.clipboard.writeText&&e&&navigator.clipboard.writeText(e).then((function(){t&&t()}))}};t.a=a},622:function(e,t,n){"use strict";var a=n(52);t.a=a.apiUpload}}]);
//# sourceMappingURL=70.8370bbd8.chunk.js.map