(this["webpackJsonpapp-admin-v5"]=this["webpackJsonpapp-admin-v5"]||[]).push([[2],{561:function(e,t,n){"use strict";var a=n(31),o=n(4),r=n(0),i=n.n(r),l=n(1),s=n(58),c=n(61),u=n(9),f=n(155),d=n(6),g=n(79),_=function(e){var t=e.props,n=e.onePage,a=e.configPage,r=Object(o.a)({},t.fnList);console.warn("fnList",t.fnList);var i=a.ScreenCode,_=a.APIName;return r[u.U]=function(e){window.document.title="".concat(e," - ").concat(l.HCF.getCF("title"))},r[u.p]=function(){return _},r[u.M]=function(){return i},r[u.K]=function(){return n},r[u.V]=function(){return n.getDataList()},r[u.L]=function(){return n.getDataOptions()},r[u.F]=function(){return n._dataTotal},r[u.G]=function(){return n.getDataExtraData()},r[u.W]=function(){return n.getSourceList()},r[u.R]=function(e){n._componentTable&&n._componentTable.handleSearch&&(n._currentSearchText=e,n._componentTable.handleSearch(e),n._oneScreenConfig._table.hasPagingRemote&&r.requestList&&r.requestList({isChangePage:!0}))},r[u.S]=function(e){if(n._manualFilterOuts=[],i){var t="".concat(i,"_ad-filter"),a={},o=l.HLocalStorage.getObj(t,null);if(o)for(var r=0,s=Object.keys(o);r<s.length;r++){var c=s[r];if(o[c]&&o[c].filter){if(a[c]=o[c].filter,a[c]&&(""===a[c].value||null===a[c].value)){delete a[c];continue}n._manualFilterOuts.push(o[c].filter)}}if(Object.keys(a).length>0&&n._oneFilters.updateCurrentFiters(a),n._filterList&&n._filterList.length>0&&Object.keys(a).length>0)for(var u=0;u<n._filterList.length;u++){var f=n._filterList[u],d=f.fieldName;a[d]&&d===a[d].fieldName&&(f.currentValue=a[d].value,f.currentFilter=a[d])}console.warn("fnLoadLocalFilter:",o,n,n._manualFilterOuts),e&&e({finish:!0})}else e&&e({finish:!1})},r[u.t]=function(){if(n&&n._dataOptions&&n._dataOptions.ChartConfig){var e=n._dataOptions.ChartConfig;return null==e.Config&&(e.Config=u.j.fnGetConfigPagePage(r,[u.b.configChart])),e}},r[u.E]=function(){return n.getDataList()},r[u.D]=function(){return n.getDataList()},r[u.s]=function(){return null},r[u.A]=function(e,t){return console.info(u.A,n,i,e,t),e?l.HUtils.has(n._oneScreenConfig._objScreenConfig,e)?l.HUtils.get(n._oneScreenConfig._objScreenConfig,e):t:n._oneScreenConfig._objScreenConfig},r[u.y]=function(e,t){return console.info(u.y,n,i,e,t),e?n._oneScreenConfig._header.hasOwnProperty(e)?n._oneScreenConfig._header[e]:t:n._oneScreenConfig._header},r[u.B]=function(e,t){return e?n._oneScreenConfig._table.hasOwnProperty(e)?n._oneScreenConfig._table[e]:t:n._oneScreenConfig._table},r[u.w]=function(e,t){return e?n._oneScreenConfig._detail.hasOwnProperty(e)?n._oneScreenConfig._detail[e]:t:n._oneScreenConfig._detail},r[u.x]=function(e,t){return e?n._oneScreenConfig._filter.hasOwnProperty(e)?n._oneScreenConfig._filter[e]:t:n._oneScreenConfig._filter},r[u.z]=function(e,t){return r[u.A]("Page.".concat(e))},r[u.Y]=function(){var e=0,t=u.j.getTabLevel(r),n=l.HLink.getParameterByName("tab")||"",o=!1;n&&(n.indexOf("%257c")>-1&&(n=n.replace(/\%257c/g,"|"),o=!0),n.indexOf("%7c")>-1&&(n=n.replace(/\%7c/g,"|"),o=!0));var i=n.split("|"),s=!1;return a.Contents&&t>=0&&(a.Contents.forEach((function(n,a){n.Id===i[t]&&(e=a,s=!0)})),!1===s&&a.Contents.length>0&&(i[t]=a.Contents[0].Id,o=!0)),o&&l.HLink.updateParamOnUrl("tab",i.join("|")),e},r[u.Z]=function(e){if(a.Contents&&a.Contents.length>e){var t=a.Contents[e].Id,n=u.j.getTabLevel(r),o=l.HLink.getParameterByName("tab").split("|");o[n]=t,l.HLink.updateParamOnUrl("tab",o.join("|"))}},r[u.X]=function(){var e=0,n=u.j.getTabLevel(t.fnList);return null!=n&&l.HIs.isNumber(n)&&(e=n+1),e},r[u.N]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=f.a.Page_GetSharedQueryOfPage(a,Object(o.a)(Object(o.a)({match:t.match,fnListOfParent:t.fnList,queryFilter:n.getQueryFilterServer()},e),{},{moreQuery:{},from:f.a.M_addItemToArrayOrCreateNewArray(e.from,t)}));return r},r.getRequestData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(o.a)(Object(o.a)({},u.j.fnGetSharedRequestData(r,[t])),e);return n},r.fnRequestUpdate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.apiController,n=e.cbSuccess,a=e.cbError,i=e.requestData,c=e.row,u=e.newValue,f=e.fieldName;console.warn("requestUpdateField",t,i,c,f,u),r.fnCustomUpdateField?r.fnCustomUpdateField({apiController:t,cbSuccess:n,cbError:a,requestData:i,row:c,newValue:u,fieldName:f}):Object(s.a)({method:"POST",url:"".concat(t,"/UpdateFields"),data:Object(o.a)(Object(o.a)({},i),{},{RequestData:r.getRequestData({},{fromApiName:d.a.UpdateFields}),Id:c.Id,Values:[{FieldName:f,NewValue:u}]})}).then((function(e){console.log("requestUpdateField:",e),e&&e.Data&&e.Data.Id==c.Id&&(c[g.KConfigInRow._UI_NeedUpdateUI]=!0,l.HUtils.mergeObjIfExist(c,e.Data)),n&&n(e)})).catch((function(e){console.warn("e:",e),a&&a(e)}))},r[u.q]=function(){var e=[],t=[];return!0===u.j.fnGetConfigPageHeader(r,[u.a.showAddNew])&&t.push(new l.OneButton({configButton:{Type:"add_new"},onePage:n})),!0===u.j.fnGetConfigPagePage(r,[u.b.hasSwitchView])&&e.push(new l.OneButton({configButton:{Type:"switch_view"},onePage:n})),[].concat(e,Object(c.a)(n.getButtonsList()),t)},r[u.o]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,a=e.config;n._currentSwitchView=t,n._currentSwitchViewConfig=a,n.forceUpdateUI()},r[u.C]=function(){var e=u.j.fnGetConfigPagePage(r,[]),t=u.j.fnGetConfigPagePage(r,[u.b.listSwitchView]),a=u.j.fnGetConfigPagePage(r,[u.b.defaultSwitchView]);return{configPage:e,type:n._currentSwitchView||a,config:n._currentSwitchViewConfig,list:t,defaut:a}},r},h=n(156),p=n(168),C=n(2),b="fnConvertUIType",O={kUI_FirstLoad:"UI_FirstLoad",kUI_IsInDetail:"UI_IsInDetail",kUI_IsInModal:"UI_IsInModal",kUI_NeedCallOptionsForContents:"UI_NeedCallOptionsForContents",kUI_NeedShowLoading:"UI_NeedShowLoading",kUI_LoadedOptions:"UI_LoadedOptions",kUI_LoadOptionError:"UI_LoadOptionError",kUI_CountRequestOptions:"UI_CountRequestOptions",kUI_CountRequestList:"UI_CountRequestList",kUI_LoadedList:"UI_LoadedList",kUI_TableCols:"UI_TableCols",convertUITypeAllContents:function(e,t){if(e&&e.length>0)for(var n=0;n<e.length;n++)t(e[n]),e[n].Contents&&O.convertUITypeAllContents(e[n].Contents,t)},requestOptionsForContents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forceUpdate;Object(s.a)({method:"POST",url:"".concat(e.APIName,"/Options"),data:{ScreenGUID:e.Id}}).then((function(t){console.warn("v:",t,l.HUtils.get(t,"Data.PageConfig.Contents")),e[O.kUI_NeedCallOptionsForContents]=!1,e[O.kUI_NeedShowLoading]=!1,e.Contents=l.HUtils.get(t,"Data.PageConfig.Contents"),null==e.Contents&&(e.Contents=[]);var a=l.HCF.getCF(b);a&&O.convertUITypeAllContents(e.Contents,a),n&&n()})).catch((function(e){console.warn("e:",e)}))},requestOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.onePage,a=t.cbSuccess,r=t.cbError,i=t.requestData;console.warn("requestOptions",e),Object(s.a)({method:"POST",url:"".concat(e.APIName,"/Options"),data:Object(o.a)({ScreenGUID:e.Id},i)}).then((function(e){console.warn("requestOptions:",e),n[O.kUI_LoadedOptions]=!0,a&&a(e)})).catch((function(e){console.warn("e:",e),r&&r(e)}))},requestList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.cbSuccess,a=t.requestData;console.log("requestList start:",e,a),Object(s.a)({method:"POST",url:"".concat(e.APIName,"/List"),data:Object(o.a)({ScreenGUID:e.Id},a)}).then((function(t){console.log("requestList res:",t),e[O.kUI_LoadedList]=!0,n&&n(t)})).catch((function(e){console.warn("e:",e)}))},requestCustom:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.apiPath,a=t.apiName,r=t.cbSuccess,i=t.cbError,l=t.requestData;console.log("requestCustom",e),Object(s.a)({method:"POST",url:"".concat(n||e.APIName,"/").concat(a||"NoApiName"),data:Object(o.a)({ScreenGUID:e.Id},l)}).then((function(e){console.log("requestCustom finish:",e),r&&r(e)})).catch((function(e){console.warn("e:",e),i&&i(e)}))},requestAddNew:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.cbSuccess,a=t.cbError,r=t.requestData;console.warn("requestAddNew",e),Object(s.a)({method:"POST",url:"".concat(e.APIName,"/Add"),data:Object(o.a)({ScreenGUID:e.Id},r)}).then((function(e){console.warn("requestAddNew:",e),n&&n(e)})).catch((function(e){console.warn("e:",e),a&&a(e)}))},requestDelete:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.row,a=t.cbSuccess,r=t.cbError,i=t.requestData,l=t.moreQuery;console.warn("requestDelete",e,n),Object(s.a)({method:"POST",url:"".concat(e.APIName,"/Delete/").concat(n.Id),data:Object(o.a)(Object(o.a)({ScreenGUID:e.Id},l),i)}).then((function(e){console.warn("requestDelete:",e),a&&a(e)})).catch((function(e){console.warn("e:",e),r&&r(e)}))}},I=0;t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.needContents,r=t.needOptions,s=t.needList,c=t.props;I++;var b=i.a.useRef(Object(o.a)({},e)),L=i.a.useRef(new l.OnePage({configPage:e})),v=i.a.useRef(0),U=i.a.useRef(1),m=L.current,F=b.current,w=i.a.useRef(_({props:c,onePage:m,configPage:F})),S=w.current;S.fnRequestDelete=function(e){O.requestDelete(F,Object(o.a)({},e))},S.fnGetSourceDataWithKey=function(e){var t=e.optionKey;return console.warn("fnGetSourceDataWithKey",m,S),(m.getDataOptions()||{})[t]};var j=Object(h.a)();return m.onForceUpdateUI=function(){j()},S.fnRequestAddNew=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.warn("fnRequestAddNew:",e),O.requestAddNew(F,Object(o.a)(Object(o.a)({},e),{},{requestData:Object(o.a)(Object(o.a)(Object(o.a)({},l.HUtils.get(c,"match.params")||{}),S.fnGetSharedRequestData({withoutQueryFilter:!0})),e.requestData)}))},S.fnRequestCustom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O.requestCustom(F,Object(o.a)(Object(o.a)({},e),{},{requestData:Object(o.a)(Object(o.a)(Object(o.a)({},l.HUtils.get(c,"match.params")||{}),S.fnGetSharedRequestData()),e.requestData)}))},S.onReloadList=S.fnReloadList,S.onReloadPage=function(){window.location.reload()},S.onShowDialog=function(e,t){u.n.fnshowDialog({title:e,msg:t})},S.openExternalUrl=function(e,t){l.HLink.openUrl(e,t)},S.fnForceUpdateTable=function(){console.warn("fnForceUpdateTable"),j()},S.onUpdateRow=function(e){var t=e.row,n=e.newRow;console.warn("onUpdateRow",t,n),t&&n&&t.Id===n.Id&&(t[g.KConfigInRow._UI_NeedUpdateUI]=!0,l.HUtils.mergeObjIfExist(t,n),j())},S.fnGetTableConfig=function(e,t){return l.HUtils.get(m,"_oneScreenConfig._table.".concat(e),t)},S.fnHandleFilterSaveLocal=function(e){var t=e||m._filterList;if(t){for(var n="".concat(m._configPage.getScreenCode(),"_ad-filter"),a={},o=0;o<t.length;o++){var r=t[o],i=r.fieldName;i&&null!=r.currentFilter&&(a[i]={filter:r.currentFilter})}a&&l.HLocalStorage.saveObj(n,a)}},S.fnHandleFilterTableBootstrap=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filterObj,n=e.filterOuts;if(m._componentTable&&m._componentTable.handleFilterData){var o=t||{},r=n||m._manualFilterOuts;if(r&&r.length>0){var i,l=Object(a.a)(r);try{for(l.s();!(i=l.n()).done;){var s=i.value;!0!==s.isServer&&(o[s.fieldName]={value:s.valueFilterClient||s.value,type:s.type})}}catch(u){l.e(u)}finally{l.f()}}m._componentTable.handleFilterData(o)}else{var c=n||m._manualFilterOuts;c&&c.length>0&&(m._waitingComponentTableForFilter=!0)}},S.fnHandleFilterAll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.filterObj,n=e.filterOuts,a=e.withoutServer;console.warn("fnHandleFilterAll:"),!0!==a&&m._oneFilters.needRequestServerAfterFilter&&(m._configPagination._pageCurrent=m._configPagination._pageStart,S.fnReloadList()),S.fnHandleFilterTableBootstrap({filterObj:t,filterOuts:n}),j()},S.requestList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.isFirst,n=e.isReload,a=e.isChangePage,r=e.isChangeSort,i=e.isRebuildTable,s=m._currentSearchText,g={};s&&(g[d.p.UI_TextSearch]=s),v.current++,O.requestList(F,{requestData:Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)(Object(o.a)({},l.HUtils.get(c,"match.params")||{}),m.getQueryPagination()),m.getQuerySort()),S.fnGetSharedRequestData()),g),cbSuccess:function(e){if(m._msgShowInUI=e.MsgShowInUI,e.Data){if((i||t)&&U.current++,console.log("cb request list:",U.current),m.parseListAndExtraData(e.Data),e.Data&&e.Data.DataTotal&&(m._dataTotal=e.Data.DataTotal),m._dataList&&m._dataList.length>0)for(var o=0;o<m._dataList.length;o++)m._dataList[o]._UI_CountReloadList=v.current;n||a||r?(m._oneScreenConfig._table.buildColsAfterReloadList&&(F[O.kUI_TableCols]=f.a.Table_BuildCols({fnList:S,onePage:m})),j()):t&&(F[O.kUI_TableCols]=f.a.Table_BuildCols({fnList:S,onePage:m}),console.log("after request list",m,m._filterList),m&&m._filterList?u.j.fnLoadLocalFilter(S,[function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.finish;t?S.fnHandleFilterAll({withoutServer:!0}):j()}]):j())}else j()}})},S.fnReloadList=function(){S.requestList&&S.requestList({isReload:!0})},S.fnDeleteItem=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=m._dataList;if(console.warn("fnDeleteItem:",t),t&&t.length>0)for(var n=0;n<t.length;n++)if(t[n].Id===e.Id){t.splice(n,1);break}j(),!0===S.fnGetTableConfig("needReloadAfterDelete",!1)&&S.fnReloadList()},S.fnGetTableCols=function(){return F[O.kUI_TableCols]},!1!==m[O.kUI_FirstLoad]&&(m[O.kUI_FirstLoad]=!1,m[O.kUI_IsInDetail]=u.j.fnGetIsInTableExpand(S),m[O.kUI_IsInModal]=u.j.fnGetIsInModal(S),!0!==m[O.kUI_IsInDetail]&&!0!==m[O.kUI_IsInModal]&&u.j.fnUpdatePageTitle(S,[F.Title]),m._oneFilters.afterChangeFilter=function(){console.warn("afterChangeFilter:",m._oneFilters.listFilter)},u.j.fnLoadLocalFilter(S,[function(){console.warn("cb load local filter:",m._manualFilterOuts)}]),m._configPagination&&(m._configPagination.afterChange=function(){console.warn("afterChange Page:"),m._oneScreenConfig._table.hasPagingRemote&&S.requestList&&S.requestList({isChangePage:!0})}),m._oneFilters&&(m._oneFilters.afterChangeSort=function(){m._oneScreenConfig._table.hasPagingRemote&&S.requestList&&S.requestList({isChangeSort:!0})}),console.error("Load first page: ",F,m)),n&&!F.Contents?(F[O.kUI_NeedCallOptionsForContents]=!0,F[O.kUI_NeedShowLoading]=!0,O.requestOptionsForContents(F,{forceUpdate:function(){j()}})):!0!==n&&(!1!==r&&null==m[O.kUI_CountRequestOptions]&&!0!==m[O.kUI_LoadedOptions]&&null==m[O.kUI_LoadOptionError]&&(m[O.kUI_CountRequestOptions]=1,O.requestOptions(F,{onePage:m,requestData:Object(o.a)(Object(o.a)({},l.HUtils.get(c,"match.params")||{}),S.fnGetSharedRequestData()),cbSuccess:function(e){e.Data&&(m[O.kUI_LoadOptionError]=null,m.parseOptions(e.Data),Object(p.FlowUpdateSizeOfPageFromLocal)(m),j())},cbError:function(e){m[O.kUI_LoadOptionError]=e,j()}})),!1===s||null!=m[O.kUI_CountRequestList]||!0===F[O.kUI_LoadedList]||!1!==r&&!0!==m[O.kUI_LoadedOptions]||(m[O.kUI_CountRequestList]=1,S.requestList&&S.requestList({isFirst:!0}))),console.log("renderPage: useConfigPage:",c,I,F,m,l.HUtils.get(c,"match.params")),{forceUpdate:j,countReloadList:U.current,configPageExt:F,showLoading:F[O.kUI_NeedShowLoading],errorMsg:null,contents:F.Contents,getTabs:function(){if(F&&F.Contents)return F.Contents.map((function(e,t){return{title:e.Title,getContent:function(){return Object(C.jsx)(l.MyPage,{configPage:e,fnList:S})},key:t}}))},onePage:m,renderLoading:function(){return Object(C.jsx)("div",{children:"Loading..."})},renderError:function(e){return Object(C.jsx)("div",{children:e})},onSearch:function(e){console.warn("onSearch:",e),S.fnHandleSearchText(e)},applyClientData:function(e,t){null!=e&&(m[O.kUI_LoadOptionError]=null,m.parseOptions(e),j()),null!=t&&(m.parseListAndExtraData(t),F[O.kUI_TableCols]=f.a.Table_BuildCols({fnList:S,onePage:m}),j())},updateComponentTable:function(e){m._componentTable,m._componentTable=e,m._componentTable&&1==m._waitingComponentTableForFilter&&(m._waitingComponentTableForFilter=!1,l.HUtils.runFuntion(S,"fnHandleFilterTableBootstrap",[]))},handleFilter:function(){m._manualFilterOuts=m._oneFilters.listFilter,console.warn("handleFilter",m._manualFilterOuts,m._oneFilters.needRequestServerAfterFilter),S.fnHandleFilterAll(),S.fnHandleFilterSaveLocal()},handleClearFilter:function(e){if(console.warn("handleClearFilter",e),e){if(m._filterList)for(var t=0;t<m._filterList.length;t++){var n=m._filterList[t];if(n.fieldName===e.fieldName){n.clear();break}}if(m._oneFilters.listFilter&&m._oneFilters.listFilter.length>0&&(m._oneFilters.listFilter=m._oneFilters.listFilter.filter((function(t,n){return t.fieldName!==e.fieldName}))),m._manualFilterOuts&&m._manualFilterOuts.length>0)for(var a=0;a<m._manualFilterOuts.length;a++){if(m._manualFilterOuts[a].fieldName===e.fieldName){m._manualFilterOuts.splice(a,1);break}}S.fnHandleFilterAll(),S.fnHandleFilterSaveLocal()}else{if(m._manualFilterOuts=[],m._filterList){for(var o="".concat(m._configPage.getScreenCode(),"_ad-filter"),r=0;r<m._filterList.length;r++){m._filterList[r].clear()}localStorage.removeItem(o)}m._oneFilters&&m._oneFilters.updateCurrentFiters({}),S.fnHandleFilterAll()}},fnList:S}}}}]);
//# sourceMappingURL=2.4a722f3f.chunk.js.map